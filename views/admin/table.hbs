<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Table: {{table.tableName}}</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f5f5f5;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 5px;
        }

        input[type="radio"] {
            margin: 0 5px;
        }

        .total-box {
            text-align: right;
            font-weight: bold;
            padding: 10px;
            background: #f5f5f5;
        }
    </style>
</head>

<body>

<h1>Edit Table: {{table.tableName}}</h1>

<form action="/admin/table/update/{{table._id}}" method="POST">
    <table>
        <thead>
        <tr>
            <th>Row Number</th>
            {{#each table.columns}}
            <th>
                <input type="text" name="columns[{{@index}}][name]" value="{{this.name}}" required>
                <label>
                    <input type="checkbox" name="columns[{{@index}}][isEditable]" {{#if this.isEditable}}checked{{/if}}>
                    Editable
                </label>
            </th>
            {{/each}}
        </tr>
        </thead>

        <tbody>
        {{#each table.data}}
        <tr>
            <td>{{this.rowNumber}}</td>
            {{#each this.columns}}
            <td>
                <select name="data[{{@../index}}][columns][{{@index}}][type]" onchange="updateInput(this)">
                    <option value="text" {{#if (eq this.type "text")}}selected{{/if}}>Text</option>
                    <option value="radio" {{#if (eq this.type "radio")}}selected{{/if}}>Radio</option>
                    <option value="marks" {{#if (eq this.type "marks")}}selected{{/if}}>Marks</option>
                    <option value="maxMarks" {{#if (eq this.type "maxMarks")}}selected{{/if}}>Max Marks</option>
                </select>

                <div class="input-box">
                    {{#if (eq this.type "text")}}
                    <input type="text" name="data[{{@../index}}][columns][{{@index}}][value]" value="{{this.value}}">
                    {{else if (eq this.type "radio")}}
                    <input type="radio" name="data[{{@../index}}][columns][{{@index}}][value]" value="Yes" {{#if (eq this.value "Yes")}}checked{{/if}}> Yes
                    <input type="radio" name="data[{{@../index}}][columns][{{@index}}][value]" value="No" {{#if (eq this.value "No")}}checked{{/if}}> No
                    {{else if (eq this.type "marks")}}
                    <input type="number" name="data[{{@../index}}][columns][{{@index}}][value]" value="{{this.value}}" oninput="calculateTotal()">
                    {{else if (eq this.type "maxMarks")}}
                    <input type="number" name="data[{{@../index}}][columns][{{@index}}][value]" value="{{this.value}}" oninput="calculateTotal()">
                    {{/if}}
                </div>
            </td>
            {{/each}}
        </tr>
        {{/each}}
        </tbody>

        <tfoot>
        <tr>
            <td colspan="100%">
                <div id="totalMarksBox" class="total-box" style="display: none;">
                    Total Marks: <span id="totalMarks">{{table.totalMarks}}</span>
                </div>
                <div id="maxMarksBox" class="total-box" style="display: none;">
                    Max Marks: <span id="maxMarks">{{table.maxMarks}}</span>
                </div>
                <div id="maxMarksBox" class="total-box" style="display: none;">
                    Percentage: <span id="maxMarks">{{table.percentage}}%</span>
                </div>
            </td>
        </tr>
        </tfoot>
    </table>

    <button type="submit">Save Changes</button>
</form>

<script>
    function updateInput(select) {
        let parent = select.closest('td');
        let inputBox = parent.querySelector('.input-box');
        let selectedType = select.value;
        let inputName = select.name.replace('[type]', '[value]');
        inputBox.innerHTML = '';

        if (selectedType === 'text') {
            inputBox.innerHTML = `<input type="text" name="${inputName}" placeholder="Enter Text">`;
        } else if (selectedType === 'radio') {
            inputBox.innerHTML = `
                <input type="radio" name="${inputName}" value="Yes"> Yes
                <input type="radio" name="${inputName}" value="No"> No
            `;
        } else if (selectedType === 'marks') {
            inputBox.innerHTML = `<input type="number" name="${inputName}" placeholder="Marks" oninput="calculateTotal()">`;
        } else if (selectedType === 'maxMarks') {
            inputBox.innerHTML = `<input type="number" name="${inputName}" placeholder="Max Marks" oninput="calculateTotal()">`;
        }
        calculateTotal();
    }

    function calculateTotal() {
        let marksInputs = document.querySelectorAll('input[type="number"][placeholder="Marks"]');
        let maxMarksInputs = document.querySelectorAll('input[type="number"][placeholder="Max Marks"]');
        let total = 0;
        let maxTotal = 0;

        marksInputs.forEach(input => {
            total += Number(input.value) || 0;
        });

        maxMarksInputs.forEach(input => {
            maxTotal += Number(input.value) || 0;
        });

        document.getElementById('totalMarks').innerText = total;
        document.getElementById('maxMarks').innerText = maxTotal;

        document.getElementById('totalMarksBox').style.display = marksInputs.length > 0 ? 'block' : 'none';
        document.getElementById('maxMarksBox').style.display = maxMarksInputs.length > 0 ? 'block' : 'none';
    }

    window.onload = calculateTotal;
</script>

</body>

</html>
